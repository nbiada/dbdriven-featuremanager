@using DbDrivenFM.App.Services
@using Microsoft.FeatureManagement
@if (featureIsEnabled)
{
    @ChildContent
}

@code {
    private bool featureIsEnabled = false;

    [Parameter] public RenderFragment ChildContent { get; set; } = null!;
    [Parameter] public string Name { get; set; } = string.Empty;

    [Inject] 
    public IFeatureManager FeatureManager { get; set; } = null!;

    protected override async Task OnInitializedAsync()
    {
        if (string.IsNullOrEmpty(Name)) return;

        featureIsEnabled = false;
        await foreach (var feature in FeatureManager.GetFeatureNamesAsync())
        {
            if (!feature.Equals(Name, StringComparison.OrdinalIgnoreCase)) continue;
            featureIsEnabled = await FeatureManager.IsEnabledAsync(Name);
            break;
        }
    }
}

